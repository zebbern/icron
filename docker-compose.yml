services:
  icron:
    build: .
    container_name: icron
    restart: unless-stopped
    # Use the restart-aware entrypoint for MCP server installation support
    entrypoint: ["/entrypoint.sh"]
    volumes:
      # Mount local config directly for easy editing
      - ~/.icron:/root/.icron
      # Persist workspace (memory, skills, TOOLS.md, etc.) - bind mount for host visibility
      - ~/.icron/workspace:/app/workspace
    environment:
      # Set your API keys here or in .env file
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      # Workspace path inside container
      - ICRON_WORKSPACE=/app/workspace
    ports:
      # Gateway port (optional, for HTTP API)
      - "3883:3883"
    # Health check for monitoring
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3883/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    # Security options
    security_opt:
      - no-new-privileges:true
    # For WhatsApp bridge headless browser support
    # Uncomment if using WhatsApp channel
    # shm_size: '2gb'
